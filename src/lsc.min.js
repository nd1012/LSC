"undefined"==typeof window.LSC&&(window.LSC=async(a,b,c)=>{var d=Math.floor;if("undefined"!=typeof window.LSC&&LSC.instance){if("undefined"!=typeof a&&a!=LSC.instance.getKey())throw new Error("Can not change LSC cache key");return b&&b>LSC.instance.getCacheVersion()&&(console.debug("Initialize newer LSC cache version",b),LSC.instance.clear(b),await LSC.instance.get(window.location.href)),LSC.instance}const f=LSC.instance=this,g=new RegExp("^[^:]+://"+document.location.hostname.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"(/.*)?$","i"),e=/^.+\.([^\.|\/]+)$/;("undefined"==typeof a||null==a)&&(a=document.location.hostname);var h="string"==typeof localStorage.getItem(a)?new Map(JSON.parse(localStorage.getItem(a))):null,i=0;const j=a=>{console.debug("LSC handle link click",a),a.preventDefault(),f.navigate(a.target.href)},k=()=>{const b=document.querySelector("html"),d=LSC.extensions,h=[];for(let[,i]of document.querySelectorAll("a:not([target])").entries())0>i.href.indexOf("?")&&0>i.href.indexOf("#")&&g.test(i.href)&&e.test(i.href)&&-1<d.indexOf(i.href.replace(e,"$1"))&&(i.addEventListener("click",j),h.push(i),(c||b.hasAttribute("data-prefetch")||i.hasAttribute("data-prefetch"))&&!b.hasAttribute("data-noprefetch")&&!i.hasAttribute("data-noprefetch")&&f.get(i.href));return LSC.events.dispatchEvent(new CustomEvent("manage",{detail:{html:b,extensions:d,managed:h}})),h};return this.getCache=()=>h,this.getKey=()=>a,this.getCacheVersion=()=>h.get("version"),this.getHistoryIndex=()=>i,this.navigate=async(a,b,c)=>{console.debug("LSC navigate to \""+a+"\"",b,c);const d=document.location.href,e="undefined"!=typeof c,g=await f.get(a);LSC.events.dispatchEvent(new CustomEvent("beforenavigate",{detail:{uri:a,noState:b,oldUri:d,history:i}})),document.querySelector("html").innerHTML=g,b?(i||e)&&(e?i=c:i--):(e?i=c:i++,history.pushState("LSC"+i,document.title,a)),k();const h=document.querySelector("body");return h&&h.hasAttribute("onload")&&new Function("event",h.getAttribute("onload"))(new Event("load")),LSC.events.dispatchEvent(new CustomEvent("navigated",{detail:{uri:a,noState:b,oldUri:d,history:i}})),g},this.update=async a=>{console.debug("Update LSC cache for \""+a+"\"");const b=await(await fetch(a)).text(),c=new CustomEvent("update",{detail:{uri:a,html:b}});if(LSC.events.dispatchEvent(c),"string"!=typeof c.detail.html){console.warn("LSC failed to fetch HTML from \""+a+"\"",c);debugger}return h.set(a,c.detail.html),c.detail.html},this.get=async a=>h.has(a)?h.get(a):await f.update(a),this.clear=a=>(console.trace("Clear LSC cache",a),h?h.clear():h=new Map,h.set("version",a?+a:d(Date.now()/1e3)),LSC.events.dispatchEvent(new CustomEvent("clear",{detail:{cache:h,version:a}})),f.store(!0)),this.store=b=>{try{console.trace("Store LSC cache",b),LSC.events.dispatchEvent(new CustomEvent("store",{detail:{cache:h}})),localStorage.setItem(a,JSON.stringify(Array.from(h.entries())))}catch(a){if(b){console.error("Failed to store the LSC cache",a);debugger}else console.error("Failed to store the LSC cache - initializing",a),f.clear(h.get("version"))}return h},console.log("LSC initializing",a,b,c),(!h||b&&h.get("version")<+b)&&this.clear(b),document.body.addEventListener("beforeunload",this.store),history.replaceState("LSC0",document.title,document.location.href),await this.get(document.location.href),window.addEventListener("popstate",async a=>{const b=window.location.href,c=parseInt(a.state.substring(3)),d=c<i;console.debug("LSC history (#"+c+") navigation "+(d?"back":"forward")+" to \""+b+"\"",a),a.preventDefault(),await f.navigate(b,!0,c),setTimeout(()=>LSC.events.dispatchEvent(new CustomEvent("history",{detail:{uri:b,index:c,back:d}})),0)}),k(),LSC.events.dispatchEvent(new Event("load")),this},LSC.instance=null,LSC.events=new EventTarget,LSC.extensions=["html","htm","php"]);