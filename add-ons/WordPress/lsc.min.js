"undefined"==typeof window.LSC&&(window.LSC=async(a,b,c)=>{var d=Math.floor;if("undefined"!=typeof window.LSC&&LSC.instance){if("undefined"!=typeof a&&a!=LSC.instance.getKey())throw new Error("Can not change LSC cache key");return b&&b>LSC.instance.getCacheVersion()&&(console.debug("Initialize newer LSC cache version",b),LSC.instance.clear(b),await LSC.instance.get(window.location.href)),LSC.instance}const f=LSC.instance=this,g=new RegExp("^[^:]+://"+document.location.hostname.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"(/.*)?$","i"),h=/^.+\.([^\.|\/]+)$/;("undefined"==typeof a||null==a)&&(a=document.location.hostname);var i="string"==typeof(LSC.options.useSessionStorage?sessionStorage:localStorage).getItem(a)?new Map(JSON.parse((LSC.options.useSessionStorage?sessionStorage:localStorage).getItem(a))):null,j=0,k=LSC.options.useSessionStorage,l=new Map;const m=async a=>(console.debug("LSC handle link click",a),LSC.options.enable?void(a.preventDefault(),await f.navigate(a.target.href)):void console.debug("LSC disabled")),n=a=>{for(let b in LSC.excluded)if(b instanceof RegEx){if(b.test(a))return!0;}else if(a.substring(0,b.length)==b)return!0;return!1},o=()=>{if(!LSC.extensions.length)return[];const b=document.querySelector("html"),d=LSC.extensions,i=[];let j;for(let[,e]of document.querySelectorAll(LSC.selector).entries())0>e.href.indexOf("?")&&0>e.href.indexOf("#")&&g.test(e.href)&&(/\/$/.test(e.href)||h.test(e.href)&&-1<d.indexOf(e.href.replace(h,"$1")))&&!n(e.href)&&(console.debug("Manage link",e.href,e),j=new CustomEvent("beforemanage",{detail:{link:e,manage:!0,preFetch:!0}}),LSC.events.dispatchEvent(j),j.detail.manage?(e.addEventListener("click",m),e.setAttribute("data-lscmanaged",null),i.push(e)):console.debug("Event handler disabled LSC link management",e),j.detail.preFetch?(!LSC.options.maxEntries||LSC.options.maxEntries>i.length)&&(c||b.hasAttribute("data-prefetch")||e.hasAttribute("data-prefetch"))&&!b.hasAttribute("data-noprefetch")&&!e.hasAttribute("data-noprefetch")&&(e.setAttribute("data-lscprefetched",null),f.get(e.href)):console.debug("Event handler disabled LSC pre-fetching",e));return LSC.events.dispatchEvent(new CustomEvent("manage",{detail:{html:b,extensions:d,managed:i}})),i};return this.getCache=()=>i,this.getKey=()=>a,this.getCacheVersion=()=>i.get("version"),this.getHistoryIndex=()=>j,this.getSessionStorage=()=>seessionStorage,this.setSessionStorage=b=>b==k?f:(k=b,k&&null!=localStorage.getItem(a)&&localStorage.removeItem(a),f.store(!0),f),this.navigate=async(a,b,c)=>{console.debug("LSC navigate to \""+a+"\"",b,c);const d=document.location.href,e="undefined"!=typeof c,g=await f.get(a,!0);if(LSC.events.dispatchEvent(new CustomEvent("beforenavigate",{detail:{uri:a,noState:b,oldUri:d,history:j}})),LSC.options.history?(document.querySelector("html").innerHTML=g,scrollTo(0,0),b?(j||e)&&(e?j=c:j--):(e?j=c:j++,history.pushState("LSC"+j,document.title,a))):(j=0,document.write(g),document.close()),o(),LSC.options.history){const a=document.querySelector("body");a&&a.hasAttribute("onload")&&new Function("event",a.getAttribute("onload"))(new Event("load"))}return LSC.events.dispatchEvent(new CustomEvent("navigated",{detail:{uri:a,noState:b,oldUri:d,history:j}})),g},this.update=async(a,b)=>{if(console.debug("Update LSC cache for \""+a+"\""),!b&&l.has(a))return console.debug("LSC avoid double-fetching \""+a+"\""),await l.get(a),i.has(a)?i.get(a):null;var c=!1;if(!b&&l.size>=LSC.options.maxConcurrentFetch){for(console.debug("Waiting for running concurrent LSC fetch-actions to finish ("+l.size+")",l),c=!0;l.size>=LSC.options.maxConcurrentFetch;await l.entries().next().value[1]);console.debug("Continue updating LSC cache for \""+a+"\"")}var d=null;l.set(a,new Promise(a=>d=a));try{const b=await(await fetch(a)).text(),c=new CustomEvent("update",{detail:{uri:a,html:b}});if(LSC.events.dispatchEvent(c),"string"!=typeof c.detail.html){console.warn("LSC failed to fetch HTML from \""+a+"\"",c),LSC.events.dispatchEvent(new CustomEvent("error",{detail:{uri:a,html:c.detail.html}}));debugger;return i.get(a)}if(i.set(a,c.detail.html),LSC.options.maxEntries&&i.size>LSC.options.maxEntries+1){let a=i.keys();a.next(),i.delete(a.next().value)}return LSC.events.dispatchEvent(new CustomEvent("updated",{detail:{uri:a,html:c.detail.html}})),c.detail.html}catch(b){console.error("Error updating LSC cache for \""+a+"\"",b);debugger;return i.get(a)}finally{d(),l.delete(a),c&&console.debug("Finished updating LSC cache for \""+a+"\"")}},this.get=async(a,b)=>i.has(a)?i.get(a):await f.update(a,b),this.clear=a=>(LSC.options.quiet||console.trace("Clear LSC cache",a),i?i.clear():i=new Map,i.set("version",a?+a:d(Date.now()/1e3)),LSC.events.dispatchEvent(new CustomEvent("clear",{detail:{cache:i,version:a}})),f.store(!0)),this.store=b=>{try{LSC.options.quiet||console.trace("Store LSC cache",b),LSC.events.dispatchEvent(new CustomEvent("store",{detail:{cache:i}})),(k?sessionStorage:localStorage).setItem(a,JSON.stringify(Array.from(i.entries())))}catch(a){if(b){console.error("Failed to store the LSC cache",a);debugger}else console.error("Failed to store the LSC cache - initializing",a),f.clear(i.get("version"))}return i},LSC.options.quiet||console.log("LSC initializing",a,b,c),(!i||b&&i.get("version")<+b)&&this.clear(b),document.body.addEventListener("beforeunload",this.store),history.replaceState("LSC0",document.title,document.location.href),await this.get(document.location.href),window.addEventListener("popstate",async a=>{if(!LSC.options.history)return;const b=window.location.href,c=parseInt(a.state.substring(3)),d=c<j;console.debug("LSC history (#"+c+") navigation "+(d?"back":"forward")+" to \""+b+"\"",a),a.preventDefault(),await f.navigate(b,!0,c),setTimeout(()=>LSC.events.dispatchEvent(new CustomEvent("history",{detail:{uri:b,index:c,back:d}})),0)}),o(),LSC.events.dispatchEvent(new Event("load")),this},LSC.instance=null,LSC.events=new EventTarget,LSC.selector="a:not([target]):not([onclick]):not([data-lscunmanaged]),a[data-lscmanaged]",LSC.extensions=["html","htm","php"],LSC.exclude=[],LSC.options={enable:!0,quiet:!1,history:!0,useSessionStorage:!1,maxEntries:0,maxConcurrentFetch:5});