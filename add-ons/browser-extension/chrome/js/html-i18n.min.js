const i18n_defaultLocale="en",i18n_messages={};var i18n_locale=null,i18n_localeUri=null,i18n_localeInfo=!1;const i18n_translate=(a,b,c)=>{if("array"==typeof a){const c=[];b=!!b;for(const d of a)c.push(i18n_translate(d,b));return c}var d,e,f,g,h;const i=(chrome||msBrowser||browser)?.i18n,j="data-i18nhtml",k="",l="undefined",m="message",n="innerText",o="innerHTML",p=a=>"Missing translation \""+a+"\"",q=["Title","Alt","Value"],r="string"==typeof a,s=r&&b||!r&&c,t=r?a:null,u=r?null:{},v=a=>i?i.getMessage(a):null==i18n_locale||typeof i18n_messages[i18n_locale]==l||typeof i18n_messages[i18n_locale][a]==l||typeof i18n_messages[i18n_locale][a][m]==l?k:i18n_messages[i18n_locale][a][m],w=c=>{e=c.hasAttribute(j),f=c.getAttribute("data-i18ninfo"),g=v(d=c.getAttribute(e?j:"data-i18ntext")),g!=k&&b||(u[d]={message:c[e?o:n],description:f,html:e,attr:null,missing:g==k}),g==k||a||(c[e?o:n]=g),s&&g==k&&console.warn(p(d),c);for(const e of q)c.hasAttribute(e)&&(g=v(h=d+e),g!=k&&b||(u[h]={message:c.getAttribute(e),description:null==f?null:f+" ("+e+")",html:!1,attr:e.toLowerCase(),missing:g==k}),g==k||a||c.setAttribute(e,g),s&&g==k&&console.warn(p(h),c))};if(r){const a=v(t);return s&&a==k&&(console.warn(p(t)),console.trace()),a}if(a instanceof HTMLElement){const d=a;return a=!1,c=!!b,b=!1,w(d),u}for(const d of document.querySelectorAll("*[data-i18ntext],*[data-i18nhtml]"))w(d);return u},i18n_text=(...a)=>{const b=a.shift(),c=i18n_translate(b);return""==c?c:(a.unshift(c),a.unshift(b),i18n_var(...a))},i18n_plural=(...a)=>{const b=(chrome||msBrowser||browser)?.i18n,c=a.shift(),d=a.shift();if(b||1==d)return a.unshift(c),i18n_text(...a);const e=null!=i18n_locale&&"undefined"!=typeof i18n_messages[i18n_locale]&&"undefined"!=typeof i18n_messages[i18n_locale][c]&&"undefined"!=typeof i18n_messages[i18n_locale][c].plural?i18n_messages[i18n_locale][c].plural:null,f=e&&"string"!=typeof e?Object.keys(e).sort((c,a)=>+c-+a):null;if(null==e)return console.warn("No plural available for \""+c+"\"",null!=i18n_locale&&"undefined"!=typeof i18n_messages[i18n_locale]&&"undefined"!=typeof i18n_messages[i18n_locale][c]?i18n_messages[i18n_locale][c]:"(unknown message ID)"),console.trace(),a.unshift(c),i18n_text(...a);var g=null==f?e:null;if(!f)for(const a in f)if(""!=a&&d<=a){g=e[a];break}return null==g&&(g=null==typeof e[""]?i18n_translate(c):e[""]),a.unshift(g),a.unshift(c),i18n_var(...a)},i18n_var=(...a)=>{const b=(chrome||msBrowser||browser)?.i18n,c=a.shift();var d=a.shift();if(b)return d;const e=null!=i18n_locale&&typeof i18n_messages[i18n_locale]!="undefined"&&typeof i18n_messages[i18n_locale][c]!="undefined"&&typeof i18n_messages[i18n_locale][c].placeholders!="undefined"?i18n_messages[i18n_locale][c].placeholders:null;var f;if(!e)return a.length&&(console.warn("No variables allowed for \""+c+"\"",null!=i18n_locale&&"undefined"!=typeof i18n_messages[i18n_locale]&&"undefined"!=typeof i18n_messages[i18n_locale][c]?i18n_messages[i18n_locale][c]:"(unknown message ID)"),console.trace()),d;for(const[b,c]of Object.entries(e))f=/^\$\d+$/.test(c.content)?a[parseInt(c.content.substring(1))-1]:c.content,d=d.replace("$"+b+"$",f);return d},i18n_determineLocale=async()=>{if(null!=i18n_locale)return i18n_locale;const a=(chrome||msBrowser||browser)?.i18n;var b=a?(await a.getAcceptLanguages())[0]:navigator.language;return 2<b.length&&2==b.indexOf("-")&&(b=b.substring(0,2)+"_"+b.substring(3)),b},i18n_loadMessages=async(a,b)=>{if(("undefined"==typeof a||null==a)&&(a=await i18n_determineLocale()),2<a.length&&2==a.indexOf("-")&&(a=a.substring(0,2)+"_"+a.substring(3)),"undefined"!=typeof i18n_messages[a])return!i18n_messages[a]&&b?await i18n_loadMessages(i18n_defaultLocale):i18n_messages[a];const c=null==i18n_localeUri?"/_locales":i18n_localeUri;if(i18n_localeInfo&&("array"!=typeof i18n_localeInfo&&(i18n_localeInfo=await(await fetch(c+"/locales.json")).json()),i18n_localeInfo&&"undefined"==typeof i18n_localeInfo[a])){if(!(2<a.length))return await i18n_loadMessages(i18n_defaultLocale);if(a=a.substring(0,2),typeof i18n_localeInfo[a]=="undefined")return await i18n_loadMessages(i18n_defaultLocale)}var d=await(await fetch(c+"/"+a+"/messages.json")).json();return!d&&2<a.lenght&&(a=a.substring(0,2),d=await(await fetch(c+"/"+a+"/messages.json")).json()),d||a!=i18n_defaultLocale||(i18n_messages[i18n_defaultLocale]=d=i18n_translate(!0)),b&&!d?await i18n_loadMessages(i18n_defaultLocale):i18n_messages[a]=d?d:null},i18n_setLocale=async(a,b)=>{2<a.length&&2==a.indexOf("-")&&(a=a.substring(0,2)+"_"+a.substring(3)),i18n_locale=a;const c=(chrome||msBrowser||browser)?.i18n,d=document.querySelector("html"),e=d?i18n_locale.substring(0,2):null;d&&d.getAttribute("lang")!=e&&d.setAttribute("lang",e);const f=c?null:await i18n_loadMessages(null,!0);return i18n_translate(!1,!1,!!b),f},i18n_init=async(a,b,c)=>(b&&!i18n_localeInfo&&(i18n_localeInfo=!0),"undefined"!=typeof a&&(i18n_localeUri=a),await i18n_setLocale(await i18n_determineLocale(),!!c),i18n_locale);